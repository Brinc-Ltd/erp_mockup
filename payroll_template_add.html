<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Payroll Template - Brinc Payroll System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .logo {
            max-height: 40px;
        }
        .content-container {
            margin-top: 20px;
        }
        .back-button {
            margin-bottom: 20px;
        }
        .column-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .column-item:hover {
            background-color: #e9ecef;
        }
        .column-list {
            min-height: 50px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .required-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            background-color: #dc3545;
            color: white;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
        .template-preview {
            overflow-x: auto;
            margin-top: 15px;
        }
        .preview-table {
            min-width: 100%;
            border-collapse: collapse;
        }
        .preview-table th {
            background-color: #f5f5f5;
            padding: 8px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .drag-handle {
            cursor: move;
            color: #6c757d;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://storage.googleapis.com/clean-finder-353810/$Dd5BJMS3vYBf7ZOld70TQI6BwJGDbX0AROpvZc0RexkhTUrPQZBO4S" alt="Brinc Logo" class="logo">
                <span class="ms-2 fw-bold">Payroll System</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="projects.html">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="payroll_dashboard.html">Payroll System</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="token_dashboard.html">Digital Currency System</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <img src="https://s3-ap-southeast-1.amazonaws.com/timeauction.paperclip/auctions/images/000/000/123/display/Manav-Gupta_Founder-CEO_brinc_profilephoto.webp?1614188921" alt="Manav" class="rounded-circle" style="width: 24px; height: 24px; object-fit: cover;"> Manav
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container content-container">
        <div class="back-button">
            <a href="payroll_setting.html" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Templates
            </a>
        </div>
        
        <h1>Add New Payroll Template</h1>
        
        <div class="alert alert-info mb-4">
            <i class="fas fa-info-circle me-2"></i> Create a new template by defining the columns needed for your payroll data. You can add, remove, and reorder columns as needed.
        </div>
        
        <form id="templateForm">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Template Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="templateName" class="form-label">Template Name</label>
                                <input type="text" class="form-control" id="templateName" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="templateRegion" class="form-label">Region</label>
                                <select class="form-select" id="templateRegion" required>
                                    <option value="">Select Region</option>
                                    <option value="Hong Kong">Hong Kong</option>
                                    <option value="Bahrain">Bahrain</option>
                                    <option value="India">India</option>
                                    <option value="Singapore">Singapore</option>
                                    <option value="China">China</option>
                                    <option value="Japan">Japan</option>
                                    <option value="MENA">MENA</option>
                                    <option value="Korea">Korea</option>
                                    <option value="United States">United States</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="templateDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="templateDescription" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Template Options</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Template Type</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="templateType" id="blankTemplate" checked>
                                    <label class="form-check-label" for="blankTemplate">
                                        Blank Template
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="templateType" id="presetTemplate">
                                    <label class="form-check-label" for="presetTemplate">
                                        Use Preset Template
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3" id="presetSelector" style="display: none;">
                                <label for="presetSelect" class="form-label">Select Preset</label>
                                <select class="form-select" id="presetSelect">
                                    <option value="">Select a preset template</option>
                                    <option value="hongkong">Hong Kong Template</option>
                                    <option value="bahrain">Bahrain Template</option>
                                    <option value="india">India Template</option>
                                    <option value="singapore">Singapore Template</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="defaultTemplate">
                                    <label class="form-check-label" for="defaultTemplate">Set as default template for this region</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Template Columns</h5>
                        <button type="button" class="btn btn-primary btn-sm" id="addColumnBtn">
                            <i class="fas fa-plus me-1"></i> Add Column
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Drag and drop to reorder columns. Required columns cannot be removed.</p>
                    
                    <div id="columnsList" class="column-list">
                        <!-- Default required columns -->
                        <div class="column-item" data-id="employee_id">
                            <div>
                                <i class="fas fa-grip-vertical drag-handle"></i>
                                <span>Employee ID</span>
                                <span class="required-badge">Required</span>
                            </div>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="column-item" data-id="name">
                            <div>
                                <i class="fas fa-grip-vertical drag-handle"></i>
                                <span>Name</span>
                                <span class="required-badge">Required</span>
                            </div>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="template-preview">
                        <h6>Template Preview</h6>
                        <table class="preview-table" id="templatePreview">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between mb-5">
                <a href="payroll_setting.html" class="btn btn-outline-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Save Template
                </button>
            </div>
        </form>
    </div>

    <!-- Add Column Modal -->
    <div class="modal fade" id="addColumnModal" tabindex="-1" aria-labelledby="addColumnModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addColumnModalLabel">Add Column</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="columnForm">
                        <div class="mb-3">
                            <label for="columnName" class="form-label">Column Name</label>
                            <input type="text" class="form-control" id="columnName" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="columnType" class="form-label">Column Type</label>
                            <select class="form-select" id="columnType" required>
                                <option value="text">Text</option>
                                <option value="number">Number</option>
                                <option value="date">Date</option>
                                <option value="dropdown">Dropdown</option>
                                <option value="currency">Currency</option>
                                <option value="percentage">Percentage</option>
                            </select>
                        </div>
                        
                        <div class="mb-3" id="dropdownOptionsDiv" style="display: none;">
                            <label for="dropdownOptions" class="form-label">Dropdown Options</label>
                            <textarea class="form-control" id="dropdownOptions" rows="3" placeholder="Enter options, one per line"></textarea>
                            <small class="text-muted">Enter each option on a new line</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="isRequired">
                                <label class="form-check-label" for="isRequired">Required Field</label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="isCalculated">
                                <label class="form-check-label" for="isCalculated">Calculated Field</label>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="calculationFormulaDiv" style="display: none;">
                            <label for="calculationFormula" class="form-label">Calculation Formula</label>
                            <input type="text" class="form-control" id="calculationFormula" placeholder="e.g., [Base Salary] + [Bonus] - [Deductions]">
                            <small class="text-muted">Use column names in square brackets</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveColumnBtn">Add Column</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-3 mt-5">
        <div class="container text-center">
            <p class="text-muted mb-0">Â© 2023 Brinc Payroll System. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Sortable.js for drag and drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Sortable for drag and drop
            new Sortable(document.getElementById('columnsList'), {
                animation: 150,
                handle: '.drag-handle',
                onEnd: function() {
                    updatePreview();
                }
            });
            
            // Toggle preset template selector
            document.getElementById('blankTemplate').addEventListener('change', function() {
                document.getElementById('presetSelector').style.display = 'none';
            });
            
            document.getElementById('presetTemplate').addEventListener('change', function() {
                document.getElementById('presetSelector').style.display = 'block';
            });
            
            // Toggle calculation formula input
            document.getElementById('isCalculated').addEventListener('change', function() {
                document.getElementById('calculationFormulaDiv').style.display = this.checked ? 'block' : 'none';
            });
            
            // Toggle dropdown options textarea
            document.getElementById('columnType').addEventListener('change', function() {
                document.getElementById('dropdownOptionsDiv').style.display = this.value === 'dropdown' ? 'block' : 'none';
            });
            
            // Preset template selection
            document.getElementById('presetSelect').addEventListener('change', function() {
                const preset = this.value;
                if (preset) {
                    loadPresetTemplate(preset);
                }
            });
            
            // Add column button
            document.getElementById('addColumnBtn').addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('addColumnModal'));
                modal.show();
            });
            
            // Save column button
            document.getElementById('saveColumnBtn').addEventListener('click', function() {
                const columnName = document.getElementById('columnName').value;
                const columnType = document.getElementById('columnType').value;
                const isRequired = document.getElementById('isRequired').checked;
                
                if (!columnName) {
                    alert('Please enter a column name');
                    return;
                }
                
                // Create new column item
                const columnItem = document.createElement('div');
                columnItem.className = 'column-item';
                columnItem.dataset.id = columnName.toLowerCase().replace(/\s+/g, '_');
                
                let columnHtml = `
                    <div>
                        <i class="fas fa-grip-vertical drag-handle"></i>
                        <span>${columnName}</span>
                        ${isRequired ? '<span class="required-badge">Required</span>' : ''}
                    </div>
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-danger delete-column">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                columnItem.innerHTML = columnHtml;
                document.getElementById('columnsList').appendChild(columnItem);
                
                // Add delete event listener
                columnItem.querySelector('.delete-column').addEventListener('click', function() {
                    columnItem.remove();
                    updatePreview();
                });
                
                // Update preview
                updatePreview();
                
                // Close modal and reset form
                bootstrap.Modal.getInstance(document.getElementById('addColumnModal')).hide();
                document.getElementById('columnForm').reset();
                document.getElementById('dropdownOptionsDiv').style.display = 'none';
                document.getElementById('calculationFormulaDiv').style.display = 'none';
            });
            
            // Form submission
            document.getElementById('templateForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const templateName = document.getElementById('templateName').value;
                const templateRegion = document.getElementById('templateRegion').value;
                
                if (!templateName || !templateRegion) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // In a real application, you would send the template data to the server
                alert('Template saved successfully!');
                window.location.href = 'payroll_setting.html';
            });
            
            // Function to update preview
            function updatePreview() {
                const previewHeaderRow = document.querySelector('#templatePreview thead tr');
                previewHeaderRow.innerHTML = '';
                
                // Get all columns
                const columns = document.querySelectorAll('#columnsList .column-item');
                
                // Add each column to preview
                columns.forEach(column => {
                    const columnName = column.querySelector('span').textContent;
                    const th = document.createElement('th');
                    th.textContent = columnName;
                    previewHeaderRow.appendChild(th);
                });
            }
            
            // Function to load preset template
            function loadPresetTemplate(preset) {
                // Clear existing columns except required ones
                const columnsList = document.getElementById('columnsList');
                const requiredColumns = Array.from(columnsList.querySelectorAll('.column-item[data-id="employee_id"], .column-item[data-id="name"]'));
                columnsList.innerHTML = '';
                requiredColumns.forEach(column => columnsList.appendChild(column));
                
                // Add preset columns based on selection
                let presetColumns = [];
                
                switch(preset) {
                    case 'hongkong':
                        presetColumns = [
                            "Department", "Position", "Start Date", "Probation", "Last date", 
                            "Monthly salary", "Salary pay", "Bonus / Commission", "Add (eg.unused AL)", 
                            "Deduction", "Total", "ER MPF", "EE MPF", "Total", "Net payroll", 
                            "Housing Allowance", "Payment in lieu", "Other Deduction after MPF", "Net payment", "Note"
                        ];
                        document.getElementById('templateName').value = 'Hong Kong Template';
                        document.getElementById('templateRegion').value = 'Hong Kong';
                        break;
                        
                    case 'bahrain':
                        presetColumns = [
                            "Region", "POSITION", "PROJECT", "EMPLOYMENT TYPE", "BASIC SALARY", 
                            "ALLOWANCE", "Pro-rated Salary", "ADDITIONS", "Overpayments/ Other Deductions", 
                            "Bahraini SIO", "Brinc Share (17%)", "Employee Share (8%)", "Brinc Share (4.2%)", 
                            "Employee Share (1%)", "GROSS PAY", "CONVERSION", "NET PAY", "STATUS", "IBAN"
                        ];
                        document.getElementById('templateName').value = 'Bahrain Template';
                        document.getElementById('templateRegion').value = 'Bahrain';
                        break;
                        
                    case 'india':
                        presetColumns = [
                            "Date of Joining", "Date of Separation", "Date of Birth", "Age more than 60?", 
                            "PAN NO.", "New Regime/ Old Regime", "Personal Email ID", "Designation", 
                            "Department", "City", "Active/ Inactive", "Comment", "CTC per month", 
                            "Basic", "HRA", "Other Allowance", "TDS Deduction", "Net Pay"
                        ];
                        document.getElementById('templateName').value = 'India Template';
                        document.getElementById('templateRegion').value = 'India';
                        break;
                        
                    case 'singapore':
                        presetColumns = [
                            "Department", "Position", "Start Date", "Probation", "Last date", 
                            "Monthly salary", "Salary pay", "Bonus / Commission", "Add (eg.unused AL)", 
                            "Deduction", "Total", "ER CPF", "EE CPF", "Total", "Net payroll", 
                            "Housing Allowance", "Other Deduction after MPF", "Net payment", "Note"
                        ];
                        document.getElementById('templateName').value = 'Singapore Template';
                        document.getElementById('templateRegion').value = 'Singapore';
                        break;
                }
                
                // Add preset columns to the list
                presetColumns.forEach(columnName => {
                    const columnItem = document.createElement('div');
                    columnItem.className = 'column-item';
                    columnItem.dataset.id = columnName.toLowerCase().replace(/\s+/g, '_');
                    
                    let columnHtml = `
                        <div>
                            <i class="fas fa-grip-vertical drag-handle"></i>
                            <span>${columnName}</span>
                        </div>
                        <div>
                            <button type="button" class="btn btn-sm btn-outline-danger delete-column">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    columnItem.innerHTML = columnHtml;
                    columnsList.appendChild(columnItem);
                    
                    // Add delete event listener
                    columnItem.querySelector('.delete-column').addEventListener('click', function() {
                        columnItem.remove();
                        updatePreview();
                    });
                });
                
                // Update preview
                updatePreview();
            }
        });
    </script>
</body>
</html>
