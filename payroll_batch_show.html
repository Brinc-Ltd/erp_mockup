<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll Batch Details - Brinc Payroll System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Handsontable CSS -->
    <link href="https://cdn.jsdelivr.net/npm/handsontable@12.3.3/dist/handsontable.full.min.css" rel="stylesheet">
    <style>
        .logo {
            max-height: 40px;
        }
        .content-container {
            margin-top: 20px;
        }
        .back-button {
            margin-bottom: 20px;
        }
        .payroll-grid {
            width: 100%;
            height: auto;
            margin-top: 10px;
            overflow: hidden;
        }
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-top: 10px;
            font-weight: bold;
        }
        .total-label {
            font-weight: bold;
        }
        .total-value {
            font-weight: bold;
        }
        .status-badge {
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            margin-left: 1rem;
        }
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        .approval-section {
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .approval-history {
            max-height: 200px;
            overflow-y: auto;
        }
        .comment-box {
            border-left: 3px solid #6c757d;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }
        .currency-badge {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background-color: #e9ecef;
            color: #495057;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://storage.googleapis.com/clean-finder-353810/$Dd5BJMS3vYBf7ZOld70TQI6BwJGDbX0AROpvZc0RexkhTUrPQZBO4S" alt="Brinc Logo" class="logo">
                <span class="ms-2 fw-bold">Payroll System</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="projects.html">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="payroll_dashboard.html">Payroll System</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="token_dashboard.html">Digital Currency System</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <img src="https://s3-ap-southeast-1.amazonaws.com/timeauction.paperclip/auctions/images/000/000/123/display/Manav-Gupta_Founder-CEO_brinc_profilephoto.webp?1614188921" alt="Manav" class="rounded-circle" style="width: 24px; height: 24px; object-fit: cover;"> Manav
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container content-container">
        <div class="back-button">
            <a href="payroll_dashboard.html" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Payroll Dashboard
            </a>
        </div>
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Payroll Batch Details</h1>
            <span class="status-badge status-pending" id="batchStatus">
                <i class="fas fa-clock me-2"></i> Pending Approval
            </span>
        </div>
        
        <div class="approval-section mb-4">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="mb-3">Approval Actions</h5>
                    <form id="approvalForm">
                        <div class="mb-3">
                            <label for="approvalComment" class="form-label">Comments</label>
                            <textarea class="form-control" id="approvalComment" rows="3" placeholder="Add your comments or feedback..."></textarea>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" id="approveBtn">
                                <i class="fas fa-check-circle me-1"></i> Approve Batch
                            </button>
                            <button type="button" class="btn btn-danger" id="rejectBtn">
                                <i class="fas fa-times-circle me-1"></i> Reject Batch
                            </button>
                        </div>
                    </form>
                </div>
                <div class="col-md-6">
                    <h5 class="mb-3">Approval History</h5>
                    <div class="approval-history">
                        <div class="comment-box">
                            <p class="mb-1"><strong>Aisling Gormley</strong> <small class="text-muted">May 28, 2023 10:15 AM</small></p>
                            <p class="mb-0">Submitted for approval.</p>
                        </div>
                        <!-- More history items would appear here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Batch Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Batch ID:</div>
                            <div class="col-md-8" id="batchId">PR-2023-05</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Payroll Template:</div>
                            <div class="col-md-8" id="templateName">Hong Kong Template</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Payroll Period:</div>
                            <div class="col-md-8" id="payrollPeriod">May 2023</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Payment Date:</div>
                            <div class="col-md-8" id="paymentDate">May 31, 2023</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Entity Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Company Entity:</div>
                            <div class="col-md-8" id="entity">Brinc Hong Kong Ltd.</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Currency:</div>
                            <div class="col-md-8" id="currency">HKD - Hong Kong Dollar</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Submitted By:</div>
                            <div class="col-md-8" id="submittedBy">Aisling Gormley</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4 fw-bold">Approver:</div>
                            <div class="col-md-8" id="approver">Manav Gupta</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Payroll Details</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2" id="exportExcelBtn">
                            <i class="fas fa-file-excel me-1"></i> Export to Excel
                        </button>
                        <button class="btn btn-sm btn-outline-danger" id="exportPdfBtn">
                            <i class="fas fa-file-pdf me-1"></i> Export to PDF
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="payrollGrid" class="payroll-grid"></div>
                
                <div id="payrollTotal" class="total-row mt-3">
                    <div class="total-label">Total:</div>
                    <div class="total-value" id="totalAmount">HKD 1,245,000.00</div>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">Notes & Attachments</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p id="batchNotes">This is the May 2023 payroll batch for Brinc Hong Kong Ltd. All employee salaries have been verified against contracts.</p>
                </div>
                
                <div class="mb-3">
                    <h6>Attachments</h6>
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-file-excel me-2 text-success"></i> May_2023_Payroll_Summary.xlsx
                            </div>
                            <a href="#" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-download"></i>
                            </a>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-file-pdf me-2 text-danger"></i> May_2023_MPF_Contribution.pdf
                            </div>
                            <a href="#" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-download"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="d-flex justify-content-between mb-5">
            <a href="payroll_dashboard.html" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
            </a>
            <div>
                <button type="button" class="btn btn-outline-primary me-2" id="syncToXeroBtn">
                    <i class="fas fa-sync me-1"></i> Sync to Xero
                </button>
                <button type="button" class="btn btn-primary" id="generatePayslipsBtn">
                    <i class="fas fa-file-invoice-dollar me-1"></i> Generate Payslips
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-3 mt-5">
        <div class="container text-center">
            <p class="text-muted mb-0">© 2023 Brinc Payroll System. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Handsontable JS -->
    <script src="https://cdn.jsdelivr.net/npm/handsontable@12.3.3/dist/handsontable.full.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample employee data for the Hong Kong template
            const employeeData = [
                { id: 'EMP-001', name: 'Aisling Gormley', department: 'Human Resources', position: 'HR Director', monthly_salary: 15000, salary_pay: 15000, bonus_commission: 1500, add_unused_al: 800, deduction: 500, total: 16800, er_mpf: 750, ee_mpf: 750, total_mpf: 1500, net_payroll: 16050 },
                { id: 'EMP-002', name: 'Castor Hui', department: 'Innovation', position: 'Corporate Innovation Director', monthly_salary: 14500, salary_pay: 14500, bonus_commission: 0, add_unused_al: 600, deduction: 450, total: 14650, er_mpf: 725, ee_mpf: 725, total_mpf: 1450, net_payroll: 13925 },
                { id: 'EMP-003', name: 'Cheyelene Singh', department: 'Marketing', position: 'Communications & Content Manager', monthly_salary: 12000, salary_pay: 12000, bonus_commission: 800, add_unused_al: 500, deduction: 400, total: 12900, er_mpf: 600, ee_mpf: 600, total_mpf: 1200, net_payroll: 12300 },
                { id: 'EMP-004', name: 'Edwin Lee', department: 'Operations', position: 'Head of Program Operations', monthly_salary: 13500, salary_pay: 13500, bonus_commission: 0, add_unused_al: 700, deduction: 425, total: 13775, er_mpf: 675, ee_mpf: 675, total_mpf: 1350, net_payroll: 13100 },
                { id: 'CON-001', name: 'Einstein Rojas', department: 'Engineering', position: 'Website Developer', monthly_salary: 9000, salary_pay: 9000, bonus_commission: 0, add_unused_al: 0, deduction: 0, total: 9000, er_mpf: 450, ee_mpf: 450, total_mpf: 900, net_payroll: 8550 },
                { id: 'EMP-005', name: 'Guillermo Ginesta', department: 'Management', position: 'Managing Director, HK', monthly_salary: 18000, salary_pay: 18000, bonus_commission: 2000, add_unused_al: 1200, deduction: 600, total: 20600, er_mpf: 900, ee_mpf: 900, total_mpf: 1800, net_payroll: 19700 }
            ];
            
            // Initialize the payroll grid in read-only mode
            const container = document.getElementById('payrollGrid');
            
            // Define columns for Hong Kong template
            const columns = [
                { data: 'id', title: 'Employee ID', readOnly: true, width: 100 },
                { data: 'name', title: 'Name', readOnly: true, width: 150 },
                { data: 'department', title: 'Department', readOnly: true, width: 120 },
                { data: 'position', title: 'Position', readOnly: true, width: 150 },
                { data: 'monthly_salary', title: 'Monthly salary', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 },
                { data: 'salary_pay', title: 'Salary pay', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 },
                { data: 'bonus_commission', title: 'Bonus / Commission', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 },
                { data: 'add_unused_al', title: 'Add (eg.unused AL)', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 },
                { data: 'deduction', title: 'Deduction', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 },
                { data: 'total', title: 'Total', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 },
                { data: 'er_mpf', title: 'ER MPF', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 80 },
                { data: 'ee_mpf', title: 'EE MPF', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 80 },
                { data: 'total_mpf', title: 'Total MPF', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 80 },
                { data: 'net_payroll', title: 'Net payroll', type: 'numeric', numericFormat: { pattern: '0,0.00' }, readOnly: true, width: 100 }
            ];
            
            // Initialize Handsontable with read-only mode
            const hot = new Handsontable(container, {
                data: employeeData,
                columns: columns,
                rowHeaders: true,
                colHeaders: true,
                height: 'auto',
                licenseKey: 'non-commercial-and-evaluation',
                readOnly: true, // Make the entire grid read-only
                disableVisualSelection: true, // Disable visual selection
                contextMenu: false, // Disable context menu
                manualColumnResize: false, // Disable column resize
                manualRowResize: false // Disable row resize
            });
            
            // Calculate total
            const calculateTotal = () => {
                let total = 0;
                employeeData.forEach(employee => {
                    total += employee.net_payroll;
                });
                
                document.getElementById('totalAmount').textContent = 'HKD ' + total.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            };
            
            // Call calculate total on load
            calculateTotal();
            
            // Approval and rejection buttons
            document.getElementById('approveBtn').addEventListener('click', function() {
                const comment = document.getElementById('approvalComment').value;
                if (!comment) {
                    alert('Please add a comment before approving.');
                    return;
                }
                
                // Update status badge
                const statusBadge = document.getElementById('batchStatus');
                statusBadge.className = 'status-badge status-approved';
                statusBadge.innerHTML = '<i class="fas fa-check-circle me-2"></i> Approved';
                
                // Add to approval history
                const approvalHistory = document.querySelector('.approval-history');
                const newComment = document.createElement('div');
                newComment.className = 'comment-box';
                newComment.innerHTML = `
                    <p class="mb-1"><strong>Manav Gupta</strong> <small class="text-muted">${new Date().toLocaleString()}</small></p>
                    <p class="mb-0"><span class="badge bg-success me-2">Approved</span> ${comment}</p>
                `;
                approvalHistory.prepend(newComment);
                
                // Disable approval buttons
                document.getElementById('approveBtn').disabled = true;
                document.getElementById('rejectBtn').disabled = true;
                document.getElementById('approvalComment').disabled = true;
                
                alert('Payroll batch has been approved!');
            });
            
            document.getElementById('rejectBtn').addEventListener('click', function() {
                const comment = document.getElementById('approvalComment').value;
                if (!comment) {
                    alert('Please add a comment explaining the rejection reason.');
                    return;
                }
                
                // Update status badge
                const statusBadge = document.getElementById('batchStatus');
                statusBadge.className = 'status-badge status-rejected';
                statusBadge.innerHTML = '<i class="fas fa-times-circle me-2"></i> Rejected';
                
                // Add to approval history
                const approvalHistory = document.querySelector('.approval-history');
                const newComment = document.createElement('div');
                newComment.className = 'comment-box';
                newComment.innerHTML = `
                    <p class="mb-1"><strong>Manav Gupta</strong> <small class="text-muted">${new Date().toLocaleString()}</small></p>
                    <p class="mb-0"><span class="badge bg-danger me-2">Rejected</span> ${comment}</p>
                `;
                approvalHistory.prepend(newComment);
                
                // Disable approval buttons
                document.getElementById('approveBtn').disabled = true;
                document.getElementById('rejectBtn').disabled = true;
                document.getElementById('approvalComment').disabled = true;
                
                alert('Payroll batch has been rejected!');
            });
            
            // Export buttons (just placeholders for now)
            document.getElementById('exportExcelBtn').addEventListener('click', function() {
                alert('Exporting to Excel... This would download an Excel file in a real application.');
            });
            
            document.getElementById('exportPdfBtn').addEventListener('click', function() {
                alert('Exporting to PDF... This would download a PDF file in a real application.');
            });
            
            // Sync to Xero button
            document.getElementById('syncToXeroBtn').addEventListener('click', function() {
                alert('Syncing to Xero... This would integrate with Xero API in a real application.');
            });
            
            // Generate Payslips button
            document.getElementById('generatePayslipsBtn').addEventListener('click', function() {
                alert('Generating payslips for all employees... This would create individual payslips in a real application.');
            });
        });
    </script>
</body>
</html>
