<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Payroll Template - Brinc Payroll System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .logo {
            max-height: 40px;
        }
        .content-container {
            margin-top: 20px;
        }
        .back-button {
            margin-bottom: 20px;
        }
        .column-item {
            padding: 10px;
            margin: 5px 0;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .column-item:hover {
            background-color: #e9ecef;
        }
        .column-list {
            min-height: 50px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .required-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            background-color: #dc3545;
            color: white;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
        .template-preview {
            overflow-x: auto;
            margin-top: 15px;
        }
        .preview-table {
            min-width: 100%;
            border-collapse: collapse;
        }
        .preview-table th {
            background-color: #f5f5f5;
            padding: 8px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .drag-handle {
            cursor: move;
            color: #6c757d;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://storage.googleapis.com/clean-finder-353810/$Dd5BJMS3vYBf7ZOld70TQI6BwJGDbX0AROpvZc0RexkhTUrPQZBO4S" alt="Brinc Logo" class="logo">
                <span class="ms-2 fw-bold">Payroll System</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="projects.html">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="payroll_dashboard.html">Payroll System</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="token_dashboard.html">Digital Currency System</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <img src="https://s3-ap-southeast-1.amazonaws.com/timeauction.paperclip/auctions/images/000/000/123/display/Manav-Gupta_Founder-CEO_brinc_profilephoto.webp?1614188921" alt="Manav" class="rounded-circle" style="width: 24px; height: 24px; object-fit: cover;"> Manav
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container content-container">
        <div class="back-button">
            <a href="payroll_setting.html" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Templates
            </a>
        </div>
        
        <h1>Edit Payroll Template</h1>
        
        <div class="alert alert-info mb-4">
            <i class="fas fa-info-circle me-2"></i> Modify the template by adding, removing, or reordering columns. Changes will affect future payroll batches using this template.
        </div>
        
        <form id="templateForm">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Template Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="templateName" class="form-label">Template Name</label>
                                <input type="text" class="form-control" id="templateName" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="templateRegion" class="form-label">Region</label>
                                <select class="form-select" id="templateRegion" required>
                                    <option value="">Select Region</option>
                                    <option value="Hong Kong">Hong Kong</option>
                                    <option value="Bahrain">Bahrain</option>
                                    <option value="India">India</option>
                                    <option value="Singapore">Singapore</option>
                                    <option value="China">China</option>
                                    <option value="Japan">Japan</option>
                                    <option value="MENA">MENA</option>
                                    <option value="Korea">Korea</option>
                                    <option value="United States">United States</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="templateDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="templateDescription" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">Template Options</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="defaultTemplate">
                                    <label class="form-check-label" for="defaultTemplate">Set as default template for this region</label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Template Usage</label>
                                <p class="text-muted mb-0">This template is currently used by <span id="batchCount" class="fw-bold">3</span> payroll batches.</p>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Last Modified</label>
                                <p class="text-muted mb-0" id="lastModified">June 15, 2023</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Template Columns</h5>
                        <button type="button" class="btn btn-primary btn-sm" id="addColumnBtn">
                            <i class="fas fa-plus me-1"></i> Add Column
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Drag and drop to reorder columns. Required columns cannot be removed.</p>
                    
                    <div id="columnsList" class="column-list">
                        <!-- Columns will be loaded dynamically -->
                    </div>
                    
                    <div class="template-preview">
                        <h6>Template Preview</h6>
                        <table class="preview-table" id="templatePreview">
                            <thead>
                                <tr>
                                    <!-- Preview headers will be added dynamically -->
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between mb-5">
                <a href="payroll_setting.html" class="btn btn-outline-secondary">Cancel</a>
                <div>
                    <button type="button" class="btn btn-outline-danger me-2" id="deleteTemplateBtn">
                        <i class="fas fa-trash me-1"></i> Delete Template
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i> Save Changes
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Add Column Modal -->
    <div class="modal fade" id="addColumnModal" tabindex="-1" aria-labelledby="addColumnModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addColumnModalLabel">Add Column</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="columnForm">
                        <div class="mb-3">
                            <label for="columnName" class="form-label">Column Name</label>
                            <input type="text" class="form-control" id="columnName" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="columnType" class="form-label">Column Type</label>
                            <select class="form-select" id="columnType" required>
                                <option value="text">Text</option>
                                <option value="number">Number</option>
                                <option value="date">Date</option>
                                <option value="dropdown">Dropdown</option>
                                <option value="currency">Currency</option>
                                <option value="percentage">Percentage</option>
                            </select>
                        </div>
                        
                        <div class="mb-3" id="dropdownOptionsDiv" style="display: none;">
                            <label for="dropdownOptions" class="form-label">Dropdown Options</label>
                            <textarea class="form-control" id="dropdownOptions" rows="3" placeholder="Enter options, one per line"></textarea>
                            <small class="text-muted">Enter each option on a new line</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="isRequired">
                                <label class="form-check-label" for="isRequired">Required Field</label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="isCalculated">
                                <label class="form-check-label" for="isCalculated">Calculated Field</label>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="calculationFormulaDiv" style="display: none;">
                            <label for="calculationFormula" class="form-label">Calculation Formula</label>
                            <input type="text" class="form-control" id="calculationFormula" placeholder="e.g., [Base Salary] + [Bonus] - [Deductions]">
                            <small class="text-muted">Use column names in square brackets</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveColumnBtn">Add Column</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this template? This action cannot be undone.</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i> Warning: This template is used by existing payroll batches. Deleting it may affect those batches.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete Template</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-3 mt-5">
        <div class="container text-center">
            <p class="text-muted mb-0">© 2023 Brinc Payroll System. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Sortable.js for drag and drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get template ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const templateId = urlParams.get('id');
            
            if (!templateId) {
                alert('Template ID is missing');
                window.location.href = 'payroll_setting.html';
                return;
            }
            
            // Load template data
            loadTemplateData(templateId);
            
            // Initialize Sortable for drag and drop
            new Sortable(document.getElementById('columnsList'), {
                animation: 150,
                handle: '.drag-handle',
                onEnd: function() {
                    updatePreview();
                }
            });
            
            // Toggle calculation formula input
            document.getElementById('isCalculated').addEventListener('change', function() {
                document.getElementById('calculationFormulaDiv').style.display = this.checked ? 'block' : 'none';
            });
            
            // Toggle dropdown options textarea
            document.getElementById('columnType').addEventListener('change', function() {
                document.getElementById('dropdownOptionsDiv').style.display = this.value === 'dropdown' ? 'block' : 'none';
            });
            
            // Add column button
            document.getElementById('addColumnBtn').addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('addColumnModal'));
                modal.show();
            });
            
            // Save column button
            document.getElementById('saveColumnBtn').addEventListener('click', function() {
                const columnName = document.getElementById('columnName').value;
                const columnType = document.getElementById('columnType').value;
                const isRequired = document.getElementById('isRequired').checked;
                
                if (!columnName) {
                    alert('Please enter a column name');
                    return;
                }
                
                // Create new column item
                const columnItem = document.createElement('div');
                columnItem.className = 'column-item';
                columnItem.dataset.id = columnName.toLowerCase().replace(/\s+/g, '_');
                
                let columnHtml = `
                    <div>
                        <i class="fas fa-grip-vertical drag-handle"></i>
                        <span>${columnName}</span>
                        ${isRequired ? '<span class="required-badge">Required</span>' : ''}
                    </div>
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-danger delete-column">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                columnItem.innerHTML = columnHtml;
                document.getElementById('columnsList').appendChild(columnItem);
                
                // Add delete event listener
                columnItem.querySelector('.delete-column').addEventListener('click', function() {
                    columnItem.remove();
                    updatePreview();
                });
                
                // Update preview
                updatePreview();
                
                // Close modal and reset form
                bootstrap.Modal.getInstance(document.getElementById('addColumnModal')).hide();
                document.getElementById('columnForm').reset();
                document.getElementById('dropdownOptionsDiv').style.display = 'none';
                document.getElementById('calculationFormulaDiv').style.display = 'none';
            });
            
            // Delete template button
            document.getElementById('deleteTemplateBtn').addEventListener('click', function() {
                const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
                deleteModal.show();
            });
            
            // Confirm delete button
            document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
                // In a real application, you would send a request to delete the template
                alert('Template deleted successfully!');
                window.location.href = 'payroll_setting.html';
            });
            
            // Form submission
            document.getElementById('templateForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const templateName = document.getElementById('templateName').value;
                const templateRegion = document.getElementById('templateRegion').value;
                
                if (!templateName || !templateRegion) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // In a real application, you would send the updated template data to the server
                alert('Template updated successfully!');
                window.location.href = 'payroll_setting.html';
            });
            
            // Function to update preview
            function updatePreview() {
                const previewHeaderRow = document.querySelector('#templatePreview thead tr');
                previewHeaderRow.innerHTML = '';
                
                // Get all columns
                const columns = document.querySelectorAll('#columnsList .column-item');
                
                // Add each column to preview
                columns.forEach(column => {
                    const columnName = column.querySelector('span').textContent;
                    const th = document.createElement('th');
                    th.textContent = columnName;
                    previewHeaderRow.appendChild(th);
                });
            }
            
            // Function to load template data
            function loadTemplateData(templateId) {
                // In a real application, you would fetch the template data from the server
                // For this demo, we'll use hardcoded data based on the template ID
                
                let templateData = {};
                
                switch(templateId) {
                    case 'hongkong':
                        templateData = {
                            name: 'Hong Kong Template',
                            region: 'Hong Kong',
                            description: 'Standard payroll template for Hong Kong employees',
                            isDefault: true,
                            lastModified: 'June 15, 2023',
                            batchCount: 3,
                            columns: [
                                { id: 'employee_id', name: 'Employee ID', required: true },
                                { id: 'name', name: 'Name', required: true },
                                { id: 'department', name: 'Department', required: false },
                                { id: 'position', name: 'Position', required: false },
                                { id: 'start_date', name: 'Start Date', required: false },
                                { id: 'probation', name: 'Probation', required: false },
                                { id: 'last_date', name: 'Last date', required: false },
                                { id: 'monthly_salary', name: 'Monthly salary', required: false },
                                { id: 'salary_pay', name: 'Salary pay', required: false },
                                { id: 'bonus_commission', name: 'Bonus / Commission', required: false },
                                { id: 'add_unused_al', name: 'Add (eg.unused AL)', required: false },
                                { id: 'deduction', name: 'Deduction', required: false },
                                { id: 'total', name: 'Total', required: false },
                                { id: 'er_mpf', name: 'ER MPF', required: false },
                                { id: 'ee_mpf', name: 'EE MPF', required: false },
                                { id: 'total_mpf', name: 'Total', required: false },
                                { id: 'net_payroll', name: 'Net payroll', required: false },
                                { id: 'housing_allowance', name: 'Housing Allowance', required: false },
                                { id: 'payment_in_lieu', name: 'Payment in lieu', required: false },
                                { id: 'other_deduction_after_mpf', name: 'Other Deduction after MPF', required: false },
                                { id: 'net_payment', name: 'Net payment', required: false },
                                { id: 'note', name: 'Note', required: false }
                            ]
                        };
                        break;
                        
                    case 'bahrain':
                        templateData = {
                            name: 'Bahrain Template',
                            region: 'Bahrain',
                            description: 'Standard payroll template for Bahrain employees',
                            isDefault: true,
                            lastModified: 'May 20, 2023',
                            batchCount: 2,
                            columns: [
                                { id: 'employee_id', name: 'Employee ID', required: true },
                                { id: 'name', name: 'Name', required: true },
                                { id: 'region', name: 'Region', required: false },
                                { id: 'position', name: 'Position', required: false },
                                { id: 'project', name: 'Project', required: false },
                                { id: 'employment_type', name: 'Employment Type', required: false },
                                { id: 'basic_salary', name: 'Basic Salary', required: false },
                                { id: 'allowance', name: 'Allowance', required: false },
                                { id: 'prorated_salary', name: 'Pro-rated Salary', required: false },
                                { id: 'additions', name: 'Additions', required: false },
                                { id: 'deductions', name: 'Overpayments/ Other Deductions', required: false },
                                { id: 'bahraini_sio', name: 'Bahraini SIO', required: false },
                                { id: 'brinc_share_17', name: 'Brinc Share (17%)', required: false },
                                { id: 'employee_share_8', name: 'Employee Share (8%)', required: false },
                                { id: 'brinc_share_4_2', name: 'Brinc Share (4.2%)', required: false },
                                { id: 'employee_share_1', name: 'Employee Share (1%)', required: false },
                                { id: 'gross_pay', name: 'Gross Pay', required: false },
                                { id: 'conversion', name: 'Conversion', required: false },
                                { id: 'net_pay', name: 'Net Pay', required: false },
                                { id: 'status', name: 'Status', required: false },
                                { id: 'iban', name: 'IBAN', required: false }
                            ]
                        };
                        break;
                        
                    case 'india':
                        templateData = {
                            name: 'India Template',
                            region: 'India',
                            description: 'Standard payroll template for India employees',
                            isDefault: true,
                            lastModified: 'April 10, 2023',
                            batchCount: 1,
                            columns: [
                                { id: 'employee_id', name: 'Employee Code', required: true },
                                { id: 'name', name: 'Name', required: true },
                                { id: 'date_of_joining', name: 'Date of Joining', required: false },
                                { id: 'date_of_separation', name: 'Date of Separation', required: false },
                                { id: 'date_of_birth', name: 'Date of Birth', required: false },
                                { id: 'age_more_than_60', name: 'Age more than 60?', required: false },
                                { id: 'pan_no', name: 'PAN NO.', required: false },
                                { id: 'regime', name: 'New Regime/ Old Regime', required: false },
                                { id: 'email', name: 'Personal Email ID', required: false },
                                { id: 'designation', name: 'Designation', required: false },
                                { id: 'department', name: 'Department', required: false },
                                { id: 'city', name: 'City', required: false },
                                { id: 'status', name: 'Active/ Inactive', required: false },
                                { id: 'comment', name: 'Comment', required: false },
                                { id: 'ctc_per_month', name: 'CTC per month', required: false },
                                { id: 'basic', name: 'Basic', required: false },
                                { id: 'hra', name: 'HRA', required: false },
                                { id: 'other_allowance', name: 'Other Allowance', required: false },
                                { id: 'tds_deduction', name: 'TDS Deduction', required: false },
                                { id: 'net_pay', name: 'Net Pay', required: false }
                            ]
                        };
                        break;
                        
                    case 'singapore':
                        templateData = {
                            name: 'Singapore Template',
                            region: 'Singapore',
                            description: 'Standard payroll template for Singapore employees',
                            isDefault: true,
                            lastModified: 'March 5, 2023',
                            batchCount: 2,
                            columns: [
                                { id: 'employee_id', name: 'Employee ID', required: true },
                                { id: 'name', name: 'Name', required: true },
                                { id: 'department', name: 'Department', required: false },
                                { id: 'position', name: 'Position', required: false },
                                { id: 'start_date', name: 'Start Date', required: false },
                                { id: 'probation', name: 'Probation', required: false },
                                { id: 'last_date', name: 'Last date', required: false },
                                { id: 'monthly_salary', name: 'Monthly salary', required: false },
                                { id: 'salary_pay', name: 'Salary pay', required: false },
                                { id: 'bonus_commission', name: 'Bonus / Commission', required: false },
                                { id: 'add_unused_al', name: 'Add (eg.unused AL)', required: false },
                                { id: 'deduction', name: 'Deduction', required: false },
                                { id: 'total', name: 'Total', required: false },
                                { id: 'er_cpf', name: 'ER CPF', required: false },
                                { id: 'ee_cpf', name: 'EE CPF', required: false },
                                { id: 'total_cpf', name: 'Total', required: false },
                                { id: 'net_payroll', name: 'Net payroll', required: false },
                                { id: 'housing_allowance', name: 'Housing Allowance', required: false },
                                { id: 'other_deduction_after_mpf', name: 'Other Deduction after MPF', required: false },
                                { id: 'net_payment', name: 'Net payment', required: false },
                                { id: 'note', name: 'Note', required: false }
                            ]
                        };
                        break;
                        
                    case 'us':
                        templateData = {
                            name: 'US Template',
                            region: 'United States',
                            description: 'Standard payroll template for US employees',
                            isDefault: true,
                            lastModified: 'February 18, 2023',
                            batchCount: 1,
                            columns: [
                                { id: 'employee_id', name: 'Employee ID', required: true },
                                { id: 'name', name: 'Name', required: true },
                                { id: 'ssn', name: 'SSN', required: false },
                                { id: 'department', name: 'Department', required: false },
                                { id: 'position', name: 'Position', required: false },
                                { id: 'start_date', name: 'Start Date', required: false },
                                { id: 'pay_rate', name: 'Pay Rate', required: false },
                                { id: 'pay_type', name: 'Pay Type', required: false },
                                { id: 'regular_hours', name: 'Regular Hours', required: false },
                                { id: 'overtime_hours', name: 'Overtime Hours', required: false },
                                { id: 'gross_pay', name: 'Gross Pay', required: false },
                                { id: 'federal_tax', name: 'Federal Tax', required: false },
                                { id: 'state_tax', name: 'State Tax', required: false },
                                { id: 'social_security', name: 'Social Security', required: false },
                                { id: 'medicare', name: 'Medicare', required: false },
                                { id: 'health_insurance', name: 'Health Insurance', required: false },
                                { id: '401k', name: '401(k)', required: false },
                                { id: 'net_pay', name: 'Net Pay', required: false }
                            ]
                        };
                        break;
                        
                    case 'uk':
                        templateData = {
                            name: 'UK Template',
                            region: 'United Kingdom',
                            description: 'Standard payroll template for UK employees',
                            isDefault: true,
                            lastModified: 'January 25, 2023',
                            batchCount: 1,
                            columns: [
                                { id: 'employee_id', name: 'Employee ID', required: true },
                                { id: 'name', name: 'Name', required: true },
                                { id: 'ni_number', name: 'NI Number', required: false },
                                { id: 'department', name: 'Department', required: false },
                                { id: 'position', name: 'Position', required: false },
                                { id: 'start_date', name: 'Start Date', required: false },
                                { id: 'salary', name: 'Salary', required: false },
                                { id: 'hourly_rate', name: 'Hourly Rate', required: false },
                                { id: 'hours_worked', name: 'Hours Worked', required: false },
                                { id: 'overtime', name: 'Overtime', required: false },
                                { id: 'gross_pay', name: 'Gross Pay', required: false },
                                { id: 'income_tax', name: 'Income Tax', required: false },
                                { id: 'ni_contribution', name: 'NI Contribution', required: false },
                                { id: 'pension', name: 'Pension', required: false },
                                { id: 'student_loan', name: 'Student Loan', required: false },
                                { id: 'other_deductions', name: 'Other Deductions', required: false },
                                { id: 'net_pay', name: 'Net Pay', required: false }
                            ]
                        };
                        break;
                        
                    default:
                        // Default empty template
                        templateData = {
                            name: '',
                            region: '',
                            description: '',
                            isDefault: false,
                            lastModified: '',
                            batchCount: 0,
                            columns: [
                                { id: 'employee_id', name: 'Employee ID', required: true },
                                { id: 'name', name: 'Name', required: true }
                            ]
                        };
                }
                
                // Populate form fields
                document.getElementById('templateName').value = templateData.name;
                document.getElementById('templateRegion').value = templateData.region;
                document.getElementById('templateDescription').value = templateData.description;
                document.getElementById('defaultTemplate').checked = templateData.isDefault;
                document.getElementById('lastModified').textContent = templateData.lastModified;
                document.getElementById('batchCount').textContent = templateData.batchCount;
                
                // Clear existing columns
                const columnsList = document.getElementById('columnsList');
                columnsList.innerHTML = '';
                
                // Add columns
                templateData.columns.forEach(column => {
                    const columnItem = document.createElement('div');
                    columnItem.className = 'column-item';
                    columnItem.dataset.id = column.id;
                    
                    let columnHtml = `
                        <div>
                            <i class="fas fa-grip-vertical drag-handle"></i>
                            <span>${column.name}</span>
                            ${column.required ? '<span class="required-badge">Required</span>' : ''}
                        </div>
                        <div>
                            <button type="button" class="btn btn-sm btn-outline-danger delete-column" ${column.required ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    columnItem.innerHTML = columnHtml;
                    columnsList.appendChild(columnItem);
                    
                    // Add delete event listener if not required
                    if (!column.required) {
                        columnItem.querySelector('.delete-column').addEventListener('click', function() {
                            columnItem.remove();
                            updatePreview();
                        });
                    }
                });
                
                // Update preview
                updatePreview();
            }
        });
    </script>
</body>
</html>